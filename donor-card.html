<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</title>
<style>
body {
  font-family: 'Noto Sans Bengali', sans-serif;
  background: #fff4f4;
  text-align: center;
  padding: 20px;
}

header {
  background: linear-gradient(135deg, #e63946, #ff6b6b);
  color: white;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

header h2 { margin: 0; font-size: 22px; }

input {
  padding: 10px;
  width: 250px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 16px;
}
button {
  padding: 10px 18px;
  margin: 5px;
  background: #e63946;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
button:hover {
  background: #d62828;
  transform: scale(1.05);
}

/* Card Design */
.card {
  display: none;
  background: linear-gradient(180deg, #fff, #ffeaea);
  border: 3px solid #e63946;
  border-radius: 15px;
  max-width: 370px;
  margin: 30px auto;
  padding: 25px 20px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  position: relative;
  text-align: left;
}

.card .profile-img {
  display: block;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  border: 3px solid #e63946;
  margin: 0 auto 10px;
  object-fit: cover;
}

.blood-drop {
  position: absolute;
  top: -20px;
  left: -20px;
  background: #e63946;
  color: white;
  width: 70px;
  height: 70px;
  border-radius: 50%;
  font-size: 22px;
  font-weight: bold;
  line-height: 70px;
  text-align: center;
  border: 3px solid white;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}

.slogan {
  text-align: center;
  font-style: italic;
  color: #a30000;
  font-size: 15px;
  margin: 10px 0;
  font-weight: 600;
}

.card h3 {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  color: #e63946;
  margin-bottom: 10px;
}

.info p {
  font-size: 15px;
  margin: 5px 0;
  color: #333;
}

/* Org info + QR */
.org-info {
  border-top: 2px dashed #ccc;
  margin-top: 8px;
  padding-top: 5px;
  font-size: 13px;
  color: #555;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/* ‚úÖ Full-Square QR Box */
.qr-box {
  width: 100px;
  height: 100px;
  background: white;
  border: 2px solid #e63946;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  box-shadow: 0 3px 6px rgba(0,0,0,0.15);
}

.qr-box canvas {
  width: 100% !important;
  height: 100% !important;
  border-radius: 0 !important;
}

.qr-text {
  font-size: 11px;
  color: #2d6a4f;
  font-weight: bold;
  margin-top: 6px;
  background: #d8f3dc;
  padding: 2px 6px;
  border-radius: 4px;
  display: inline-block;
  text-align: center;
}

#credit {
  text-align: right;
  background: #2d6a4f;
  color: white;
  font-size: 11px;
  padding: 4px 8px;
  border-radius: 6px;
  width: fit-content;
  float: right;
  margin-top: 8px;
}

#msg {
  color: #e63946;
  margin-top: 10px;
}
</style>
</head>
<body>

<header>
  <h2>ü©∏ ‡¶∞‡¶ï‡ßç‡¶§ ‡¶¶‡¶æ‡¶§‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</h2>
</header>

<div>
  <input type="text" id="phone" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
  <button onclick="getDonor()">üîç ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</button>
  <p id="msg"></p>
</div>

<div id="card" class="card">
  <div class="blood-drop" id="blood"></div>
  <div class="slogan">‚Äú‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶´‡ßã‡¶Å‡¶ü‡¶æ ‡¶∞‡¶ï‡ßç‡¶§‡ßá ‡¶¨‡¶æ‡¶Å‡¶ö‡ßÅ‡¶ï ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ú‡ßÄ‡¶¨‡¶®‚Äù</div>

  <img id="photo" class="profile-img" src="" alt="photo">
  <h3 id="name"></h3>

  <div class="info">
    <p><b>‡¶Ü‡¶á‡¶°‡¶ø:</b> <span id="id"></span></p>
    <p><b>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</b> <span id="mobile"></span></p>
    <p><b>‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</b> <span id="address"></span></p>
  </div>

  <div class="org-info">
    <div style="text-align:center;">
      <div class="qr-box">
        <div id="qrcode"></div>
      </div>
      <div class="qr-text">‚úÖ Verify Donor</div>
    </div>
    <div class="org-text">
      <p><b>‡¶∞‡¶ï‡ßç‡¶§ ‡¶¶‡¶æ‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶´‡¶æ‡¶â‡¶®‡ßç‡¶°‡ßá‡¶∂‡¶®</b></p>
      <p>üìç ‡¶Æ‡¶π‡ßá‡¶∂‡¶™‡ßÅ‡¶∞, ‡¶ù‡¶ø‡¶®‡¶æ‡¶á‡¶¶‡¶π</p>
      <p>üìû +8801973561236</p>
    </div>
  </div>

  <div id="credit">‡¶Ü‡¶á‡¶ü‡¶ø ‡¶∏‡¶π‡¶Ø‡ßã‡¶ó‡ßÄ‡¶§‡¶æ‡ßü - ‡¶¨‡ßç‡¶∞‡¶æ‡¶á‡¶ü ‡¶Ü‡¶á‡¶ü‡¶ø</div>
</div>

<button id="downloadBtn" style="display:none;">üì∏ Save as Image</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbwZcFwXtuj6EIem_nOoTn7DcWqt-XKDSQ1xog9f6O05IGUCgKwoBgsHHLGJvvMnybk/exec";

async function getDonor() {
  const phone = document.getElementById("phone").value.trim();
  const msg = document.getElementById("msg");
  const card = document.getElementById("card");
  const downloadBtn = document.getElementById("downloadBtn");

  msg.innerHTML = "";
  card.style.display = "none";
  downloadBtn.style.display = "none";

  if (!phone) {
    msg.innerHTML = "‚ö†Ô∏è ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®!";
    return;
  }

  try {
    msg.innerHTML = "‚è≥ ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
    const res = await fetch(SHEET_URL);
    const donors = await res.json();
    const donor = donors.find(d => d.Phone == phone);

    if (donor) {
      document.getElementById("blood").innerText = donor.Blood || "N/A";
      document.getElementById("photo").src = donor.Photo || "";
      document.getElementById("name").innerText = donor.Name || "";
      document.getElementById("mobile").innerText = donor.Phone || "";
      document.getElementById("address").innerText = donor.Address || "";
      const idNumber = (donors.indexOf(donor) + 1).toString().padStart(3, "0");
      document.getElementById("id").innerText = idNumber;

      card.style.display = "block";
      msg.innerHTML = "";

      const qrDiv = document.getElementById("qrcode");
      qrDiv.innerHTML = "";
      new QRCode(qrDiv, {
        text: `Donor ID: ${idNumber}\nName: ${donor.Name}\nPhone: ${donor.Phone}`,
        width: 100,
        height: 100
      });

      downloadBtn.style.display = "inline-block";
    } else {
      msg.innerHTML = "‚ùå ‡¶è‡¶á ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá‡¶∞ ‡¶ï‡ßã‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!";
    }
  } catch (err) {
    msg.innerHTML = "‚ö†Ô∏è ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
    console.error(err);
  }
}

// üì∏ Save as Image
document.getElementById("downloadBtn").addEventListener("click", async () => {
  const card = document.getElementById("card");
  const canvas = await html2canvas(card, { useCORS: true });
  const link = document.createElement("a");
  link.download = "BloodDonorCard.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
});
</script>

</body>
</html>
